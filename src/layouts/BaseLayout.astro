---
import "../styles/global.css";
import CookieBanner from "../components/CookieBanner.astro";
import { withBase } from "../utils/utils.ts";
const {
  title = "SlotBotBuddy",
  description = "SlotBotBuddy hilft Studierenden bei zeitkritischen Anmeldungen zu Lehrveranstaltungen und Prüfungen.",
  showFooter = true,
  lockPageScroll = false,
} = Astro.props;

const currentPath = Astro.url?.pathname ?? "/";
const BASE_URL = import.meta.env.BASE_URL;
const baseNoTrailing =
  BASE_URL.endsWith("/") && BASE_URL !== "/" ? BASE_URL.slice(0, -1) : BASE_URL;

const primaryNav = [
  { label: "Startseite", href: "/" },
  { label: "Abos", href: "/subscriptions" },
  { label: "Über uns", href: "/about" },
  { label: "Kontakt", href: "/contact" },
];

const footerNav = [
  { label: "Impressum", href: "/imprint" },
  { label: "Datenschutz", href: "/privacy" },
  { label: "Barrierefreiheit", href: "/accessibility" },
  { label: "Urheberrecht", href: "/credits" },
  { label: "Lizenz", href: "/license" },
];

function isActive(href: string) {
  if (href.includes("#")) return false;

  const resolved = new URL(withBase(href), Astro.url).pathname;

  if (resolved === "/") return currentPath === "/";
  return currentPath === resolved || currentPath.startsWith(resolved + "/");
}
---

<!doctype html>
<html lang="de">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="description" content={description} />
    <title>{title}</title>

    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:type" content="website" />
    <meta name="twitter:card" content="summary_large_image" />
  </head>

  <body class:list={["app", lockPageScroll && "lock-scroll"]}>
    <header class="app-header">
      <div class="container">
        <div class="topbar">
          <a
            class="brand"
            href={withBase("/")}
            aria-label="SlotBotBuddy Startseite"
          >
            <img
              src={withBase("/media/images/brand/logo-slotbotbuddy.png")}
              class="logo"
              alt="SlotBotBuddy Logo"
            />
          </a>

          <nav aria-label="Hauptnavigation">
            {
              primaryNav.map((item) => (
                <a
                  class={"navlink" + (isActive(item.href) ? " active" : "")}
                  href={withBase(item.href)}
                >
                  {item.label}
                </a>
              ))
            }
            <a
              class="btn primary"
              href={withBase("/checkout")}
              data-plan="premium"
            >
              Premium starten
            </a>
          </nav>
        </div>
      </div>
    </header>

    <main class="app-main">
      <div class="container app-content">
        <slot />
      </div>
    </main>

    {
      showFooter ? (
        <footer class="app-footer">
          <div class="container">
            <div class="footergrid">
              <div>
                <strong style="color: var(--text)">Slot Bot Labs</strong>
                <br />
                <span>Wien, Österreich</span>
              </div>

              <nav class="footernav" aria-label="Rechtliches">
                {footerNav.map((item, idx) => (
                  <>
                    <a href={withBase(item.href)}>{item.label}</a>
                    {idx < footerNav.length - 1 ? (
                      <span class="dotsep" aria-hidden="true">
                        ·
                      </span>
                    ) : null}
                  </>
                ))}

                <span class="dotsep" aria-hidden="true">
                  ·
                </span>
                <a href="#" id="footer-cookie-settings">
                  Cookie-Einstellungen
                </a>
              </nav>
            </div>
          </div>
        </footer>
      ) : null
    }
    <CookieBanner />
  </body>
</html>
<script>
  import { initCookieClient } from "../utils/cookies.ts";
  import "../utils/checkout.ts"
  initCookieClient();
</script>
