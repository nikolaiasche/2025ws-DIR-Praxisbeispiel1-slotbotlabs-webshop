---
const {
  title = "SlotBotBuddy",
  description = "SlotBotBuddy hilft Studierenden bei zeitkritischen Anmeldungen zu Lehrveranstaltungen und Prüfungen.",
  showFooter = true,
} = Astro.props;

const currentPath = Astro.url?.pathname ?? "/";
const BASE_URL = import.meta.env.BASE_URL;
const baseNoTrailing =
  BASE_URL.endsWith("/") && BASE_URL !== "/" ? BASE_URL.slice(0, -1) : BASE_URL;

const withBase = (path) => {
  if (!path) return BASE_URL;
  if (path.startsWith("#")) return path; // anchors stay as-is
  if (path.startsWith("/")) return `${baseNoTrailing}${path}` || path;
  return `${BASE_URL}${path}`;
};

const primaryNav = [
  { label: "Startseite", href: "/" },
  { label: "Abos", href: "/abo" },
  { label: "Über uns", href: "/about" },
  { label: "Kontakt", href: "/contact" },
];

const footerNav = [
  { label: "Impressum", href: "/imprint" },
  { label: "Datenschutz", href: "/privacy" },
  { label: "Barrierefreiheit", href: "/accessibility" },
  { label: "Lizenz", href: "/license" },
  { label: "Urheberrecht", href: "/credits" },
];

function isActive(href) {
  if (href.includes("#")) return false;
  const resolved = new URL(withBase(href), Astro.url).pathname;

  if (href === "/") return currentPath === resolved;
  return currentPath.startsWith(resolved);
}
---

<!doctype html>
<html lang="de">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="description" content={description} />
    <title>{title}</title>

    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:type" content="website" />
    <meta name="twitter:card" content="summary_large_image" />

    <style>
      :root{
        --bg: #0b0f19;
        --surface: #111827;
        --surface-2: #0f172a;
        --text: #e5e7eb;
        --muted: #9ca3af;
        --border: rgba(255,255,255,.12);
        --shadow: 0 16px 50px rgba(0,0,0,.35);
        --radius: 16px;
        --max: 1040px;
        --pad: 24px;

        --accent: #7c3aed;
        --accent-2: #22c55e;
      }

      *{ box-sizing:border-box; }
      html,body{ height:100%; }
      body{
        margin:0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
        background: radial-gradient(1200px 600px at 20% -10%, rgba(124,58,237,.25), transparent),
                    radial-gradient(900px 500px at 90% 0%, rgba(34,197,94,.18), transparent),
                    var(--bg);
        color: var(--text);
        line-height: 1.5;
      }

      a{ color: inherit; text-decoration: none; }
      a:hover{ text-decoration: underline; }

      .container{
        width: 100%;
        max-width: var(--max);
        margin: 0 auto;
        padding: 0 var(--pad);
      }

      header{
        position: sticky;
        top: 0;
        z-index: 20;
        backdrop-filter: blur(10px);
        background: rgba(11,15,25,.7);
        border-bottom: 1px solid var(--border);
      }

      .topbar{
        display:flex;
        align-items:center;
        justify-content:space-between;
        gap:16px;
        padding: 14px 0;
      }

      .brand{
        display:flex;
        align-items:center;
        gap:10px;
        font-weight: 700;
        letter-spacing: .2px;
      }

      .logo{
        width: 34px;
        height: 34px;
        border-radius: 10px;
        background:
          linear-gradient(135deg, rgba(124,58,237,.95), rgba(34,197,94,.85));
        box-shadow: 0 10px 25px rgba(124,58,237,.25);
      }

      nav{
        display:flex;
        align-items:center;
        gap:14px;
        flex-wrap:wrap;
      }

      .navlink{
        padding: 8px 10px;
        border-radius: 10px;
        color: var(--muted);
      }
      .navlink.active{
        color: var(--text);
        background: rgba(255,255,255,.06);
        border: 1px solid var(--border);
      }

      main{ padding: 24px 0 26px; }

      footer{
        border-top: 1px solid var(--border);
        padding: 18px 0;
        color: var(--muted);
        background: rgba(17,24,39,.35);
      }
      .footergrid{
        display:flex;
        align-items:flex-start;
        justify-content:space-between;
        gap:18px;
        flex-wrap:wrap;
      }
      .footernav{
        display:flex;
        gap:12px;
        flex-wrap:wrap;
      }
      .dotsep{ opacity:.6; }

      .btn{
        display:inline-flex;
        align-items:center;
        justify-content:center;
        gap:10px;
        padding: 10px 14px;
        border-radius: 12px;
        border: 1px solid var(--border);
        background: rgba(255,255,255,.06);
        color: var(--text);
        text-decoration:none;
        font-weight: 600;
      }
      .btn:hover{ text-decoration:none; filter: brightness(1.05); }
      .btn.primary{
        background: linear-gradient(135deg, rgba(124,58,237,.95), rgba(124,58,237,.65));
        border-color: rgba(124,58,237,.55);
      }

      .sr-only{
        position:absolute; width:1px; height:1px; padding:0; margin:-1px;
        overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0;
      }
    </style>
  </head>

  <body>
    <header>
      <div class="container">
        <div class="topbar">
          <a class="brand" href={withBase("/")} aria-label="SlotBotBuddy Startseite">
            <span class="logo" aria-hidden="true"></span>
            <span>SlotBotBuddy</span>
          </a>

          <nav aria-label="Hauptnavigation">
            {primaryNav.map((item) => (
              <a
                class={"navlink" + (isActive(item.href) ? " active" : "")}
                href={withBase(item.href)}
              >
                {item.label}
              </a>
            ))}
            <a class="btn primary" href={withBase("/checkout?plan=premium")}>Premium starten</a>
          </nav>
        </div>
      </div>
    </header>

    <main>
      <div class="container">
        <slot />
      </div>
    </main>

    {showFooter ? (
      <footer>
        <div class="container">
          <div class="footergrid">
            <div>
              <strong style="color: var(--text)">Slot Bot Labs</strong><br />
              <span>Wien, Österreich</span>
            </div>

            <nav class="footernav" aria-label="Rechtliches">
              {footerNav.map((item, idx) => (
                <>
                  <a href={withBase(item.href)}>{item.label}</a>
                  {idx < footerNav.length - 1 ? <span class="dotsep" aria-hidden="true">·</span> : null}
                </>
              ))}
            </nav>
          </div>
        </div>
      </footer>
    ) : null}
  </body>
</html>
